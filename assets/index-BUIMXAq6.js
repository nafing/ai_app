import{u as v,R as l,d as n,j as e,G as d,B as o,L as A,M as k,T as p,g as b}from"./index-B4XXapqm.js";import{u as B}from"./dexie-react-hooks-C39wFvoC.js";import{e as H,F as L,p as O}from"./exportImport-hqSfzcEj.js";import{T as U}from"./Title-BN9HuS6F.js";import{S as f}from"./Stack-DXppRYmq.js";import{C as q}from"./Card-CV6FZI7P.js";function X(){const i=B(()=>n.presets.toArray()),[j,c]=v(),[a,S]=l.useState(null),[F,m]=v(!1),[z,P]=l.useState(!1),[C,u]=l.useState(null),[E,I]=l.useState(""),x=l.useRef(null),N=s=>{S(s),c.open()},D=l.useCallback(async()=>{const s=await n.presets.toArray()??[];H("presets",s)},[]),M=s=>{x.current=s,I(s?s.name:""),u(null)},T=async()=>{if(!x.current){u("Select a JSON file before importing.");return}P(!0),u(null);try{const s=await O("presets",x.current);if(s.length===0)throw new Error("Import file does not contain any presets.");const r=(t,g)=>{const h=Number(t);return Number.isFinite(h)?h:g},y=s.map(t=>{const g=typeof t.id=="string"?t.id.trim():"",h=(t.name??"").trim(),R=(t.model??"").trim();return{id:g||b(),isActive:!!t.isActive,name:h||"Unnamed Preset",model:R||"unknown-model",preHistoryInstructions:t.preHistoryInstructions??"",postHistoryInstructions:t.postHistoryInstructions??"",impersonationPrompt:t.impersonationPrompt??"",temperature:r(t.temperature,.7),repetitionPenalty:r(t.repetitionPenalty,1),frequencyPenalty:r(t.frequencyPenalty,0),presencePenalty:r(t.presencePenalty,0),topP:r(t.topP,1),topK:Math.max(0,Math.round(r(t.topK,40))),contextSize:Math.max(0,Math.round(r(t.contextSize,2048))),maxNewToken:Math.max(0,Math.round(r(t.maxNewToken,2048)))}}),w=new Map;for(const t of y)w.has(t.id)&&(t.id=b(),t.isActive=!1),w.set(t.id,t);await n.transaction("rw",n.presets,async()=>{await n.presets.bulkPut(Array.from(w.values()))}),m.close(),I(""),x.current=null}catch(s){const r=s instanceof Error?s.message:"Failed to import presets.";u(r)}finally{P(!1)}};return e.jsxs(l.Fragment,{children:[e.jsxs(d,{justify:"space-between",align:"end",mb:"md",children:[e.jsx(U,{order:2,children:"Presets"}),e.jsxs(d,{gap:"xs",children:[e.jsx(o,{variant:"default",onClick:D,children:"Export"}),e.jsx(o,{variant:"default",onClick:m.open,children:"Import"}),e.jsx(o,{component:A,to:"/preset/new/",children:"New Preset"})]})]}),e.jsx(f,{gap:"xs",children:i?.map(s=>e.jsx(G,{p:s,onDelete:()=>N(s.id),setAsActive:()=>{n.transaction("rw",n.presets,async()=>{const r=await n.presets.toArray();for(const y of r)await n.presets.update(y.id,{isActive:!1});await n.presets.update(s.id,{isActive:!0})})}},s.id))}),e.jsxs(k,{opened:j,onClose:c.close,title:"Delete Preset",children:["Are you sure you want to delete this preset?",e.jsxs(d,{mt:"md",justify:"flex-end",children:[e.jsx(o,{variant:"default",onClick:c.close,children:"Cancel"}),e.jsx(o,{color:"red",onClick:async()=>{a&&await n.presets.delete(a),c.close()},children:"Delete"})]})]}),e.jsx(k,{opened:F,onClose:m.close,title:"Import Presets",children:e.jsxs(f,{children:[e.jsx(p,{size:"sm",children:"Import presets from a JSON export file. Existing presets with the same identifier will be overwritten."}),e.jsxs(d,{justify:"space-between",align:"center",children:[e.jsx(L,{onChange:M,accept:"application/json",children:s=>e.jsx(o,{...s,variant:"default",size:"compact-sm",children:"Choose File"})}),e.jsx(p,{size:"sm",c:"dimmed",children:E||"No file selected"})]}),C&&e.jsx(p,{size:"sm",c:"red",children:C}),e.jsxs(d,{justify:"flex-end",mt:"sm",children:[e.jsx(o,{variant:"default",onClick:m.close,children:"Cancel"}),e.jsx(o,{onClick:T,loading:z,children:"Import"})]})]})})]})}function G({p:i,onDelete:j,setAsActive:c}){return e.jsx(q,{radius:"md",p:"md",withBorder:!0,style:{backdropFilter:"saturate(180%) blur(20px)",backgroundColor:`rgba(0, 0, 0, ${i.isActive?.85:.25})`},onClick:()=>c(),children:e.jsxs(d,{justify:"space-between",wrap:"nowrap",children:[e.jsxs(f,{gap:4,children:[e.jsxs(p,{fw:600,children:[i.name," (",i.isActive?"Active":"Inactive",")"]}),e.jsx(p,{size:"sm",c:"dimmed",children:i.model})]}),e.jsxs(f,{gap:"xs",children:[e.jsx(o,{onClick:a=>{a.stopPropagation()},component:A,to:`/preset/${i.id}`,size:"compact-xs",children:"Edit"}),e.jsx(o,{size:"compact-xs",color:"red",onClick:a=>{a.preventDefault(),a.stopPropagation(),j()},children:"Delete"})]})]})})}export{X as component};
