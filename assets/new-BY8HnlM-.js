import{l as h,a as m,r as u,i as s,j as a,G as p,B as b,d as r}from"./index-BUOXtG_d.js";import{u as I,h as x,T as j}from"./has-length-BCpRYZ0r.js";import{S as f}from"./Stack-CQdDs9Ke.js";import{T as k}from"./Title-LiqCpP7-.js";import{M as c}from"./MultiSelect-CcVrSgfZ.js";function C(){const{characters:l,lorebooks:d}=h.useLoaderData(),i=m(),o=u.useMemo(()=>({chatId:s(),branchId:s()}),[]),t=I({mode:"uncontrolled",initialValues:{id:o.chatId,name:"",characterIds:[],lorebookIds:[],activeBranchId:o.branchId},validate:{name:x({min:1},"Name is required"),characterIds:e=>e.length===0?"At least one character must be selected":null}});return a.jsx("form",{onSubmit:t.onSubmit(async e=>{const n=e.activeBranchId??s();await r.transaction("rw",r.chats,r.chatBranches,async()=>{await r.chats.add({...e,activeBranchId:n}),await r.chatBranches.add({id:n,chatId:e.id,name:"Main",parentBranchId:null,pivotMessageId:null,createdAt:Date.now()})}),i({to:"/chat"})}),children:a.jsxs(f,{children:[a.jsxs(p,{justify:"space-between",align:"end",mb:"md",children:[a.jsx(k,{order:2,children:"New Chat"}),a.jsx(b,{type:"submit",children:"Create Chat"})]}),a.jsx(j,{label:"Name",placeholder:"Enter chat name",...t.getInputProps("name")},t.key("name")),a.jsx(c,{label:"Characters",placeholder:"Select characters",data:l.map(e=>({value:e.id,label:e.inChatName}))||[],...t.getInputProps("characterIds"),multiple:!0,searchable:!0},t.key("characterIds")),a.jsx(c,{label:"Lorebooks",placeholder:"Attach lorebooks",data:d.map(e=>({value:e.id,label:e.name})),...t.getInputProps("lorebookIds"),multiple:!0,searchable:!0,clearable:!0},t.key("lorebookIds"))]})})}export{C as component};
